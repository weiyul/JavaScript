<!-- This application allows you to calculate loan payment each month. The original code is from the book "JavaScript The Definitive Guide" By David Flangan
 * I retyped the code and made a slight modification by simply omitting the section of ZipCode and Sponsors, which I found cannot work without another php * file
 * If you want to see the origianl code, please go to http://examples.oreilly.com/9780596805531/
 -->

<!DOCTYPE html>
<html>
    <head>
    <title>JaveScript Loan Calculator</title>
    <style>
        .output {font-weight: bold;}
        #payment {text-decoration: underline;} //For element with id ="payment"
        #graph {border: solid black 1px;}
        th, td {vertical-align: top;}
    </style>    
    </head>
    <body>
    <!-- This is an HTML table with <input> elements that allow the user to enter data and <span> elements in which the program can display its results. These elements have ids like "interest" and "years". These ids are used in the JavaScript code that follows the table. Note that some of the input elements define "onchange" or "onclice" event handlers. These specify strings of JavaScript code to be executed when the user enters data or clicks.-->
    <table>
        <tr><th>Enter Load Data:</th><td></td><th>Loan Balance, Cumulative Equity, and Interest Payments</th></tr>
        <tr><td>Amount of the loan ($):</td><td><input id="amount" onchange="Calculate();"</td><td rowspan=8><canvas id="graph" width="400" height="250"></canvas></td></tr>
        <tr><td>Annual interest (%)</td><td><input id="apr" onchange="calculate();"></td></tr>
        <tr><td>Repayment period (years)</td><td><input id="years" onchange="calculate();"></td></tr>
        <tr><th>Approximate Payments:</th><td><button onclick="calculate();">Calculate</button></td></tr>
        <tr><td>Monthly payment:</td><td>$<span class="output" id="payment"></span></td></tr>
        <tr><td>Total payment:</td><td>$<span class="output" id="total"></span></td></tr>
        <tr><td>Total interest:</td><td>$<span class="output" id="totalinterest"></span></td></tr>
        
    </table>
    <script>
        /* This script defines the calculate() function called by the event handlers in HTML above. The function reads values from <input> elements,  
     * calculates loan payment information, displays the results in <span> elements. It also saves the user's data, displays links to lenders, and draws a chart
     */
    function calculate(){
        var amount = document.getElementById("amount");
        var apr = document.getElementById("apr");
        var years = document.getElementById("years");
        var payment = document.getElementById("payment");
        var total = document.getElementById("total");
        var totalinterest = document.getElementById("totalinterest");
        
        // Get the user's input from the input elements. Assume it is all valid. Convert interest from a percentage to a decimal, and convert from an annual rate to a monthly rate. Convert payment period in years to the 
        // number of monthly payments. 
        var principal = parseFloat(amount.value);
        var interest = parseFloat(apr.value)/100/12; //calculate interest per month
        var payments = parseFloat(years.value)*12; //calculate how many times to pay per year
        
        // Now compute the monthly payment figure. 
        var x = Math.pow(1+ interest, payments); // calculate compunt interest rate yearly
        var monthly = (principal*x*interest)/(x-1);  //calculate monthly payment
        
        //if the result is a finite number, the user's input was goo we have meaningful results to display
        if(isFinite(monthly)){
            // Fill in the output fields, rounding to 2 decimal places
            payment.innerHTML = monthly.toFixed(2);
            total.innerHTML = (monthly*payments).toFixed(2);
            totalinterest.innerHTML = ((monthly*payments)-principal).toFixed(2);
        
            // Save the user's input so we can restore it the next time they visit
            save(amount.value,apr.value,years.value);
            
            // Finally, chart loan balance, and interest and equity payment
            chart(principal, interest, monthly, payments);

        
        }else{
            // Result was Not-a-Number or infinite, which means the input was incomplete or invalid. Clear any previously displayed output. 
            payment.innerHTML = ""; // Erase the content of these elements
            total.innerHTML =  "";
            totalinterest.innerHTML =  "";
            chart(); // With no arguments, clears the chart
        }

        
    }
        
    // Save the user's input as properties of the localStorage object. Those properties will still be there when the user visits in the future. This storage feature will not work in some browsers (Firefox, e.g.)
    // If you run the example from a local file://URL. It does work over HTTP, however,
    
    function save(amount,apr,years){
        if(window.localStorage){
            localStorage.loan_amount = amount;
            localStorage.loan_apr = apr;
            localStorage.loan_years = years;
        }
        
    }
        
    // Automatically attempt to restore input fields when the document first loads
    window.onload= function(){
        // If the browser supports localStorage and we have some stored data
        if(window.localStorage && localStorage.loan_amount){
            document.getElementById("amount").value = localStorage.loan_amount;
            document.getElementById("apr").value = localStorage.loan_apr;
            document.getElementById("years").value = localStorage.loan_years;
        }
    }
        
    function chart(principal, interest, monthly, payments){
        
    }
        
    </script>
    
    </body>
</html>
